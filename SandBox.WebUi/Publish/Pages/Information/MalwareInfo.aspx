<%@ Page Title="" Language="C#" MasterPageFile="~/Main.master" AutoEventWireup="true" CodeBehind="MalwareInfo.aspx.cs" Inherits="SandBox.WebUi.Pages.Information.MalwareInfo" %>
<asp:Content ID="Content1" ContentPlaceHolderID="MainContent" runat="server">
<link rel="stylesheet" type="text/css" href="../../Content/PageView.css"  />

<script type="text/javascript">
    function OnDeleteClick(element, key) {
        popup_delete.ShowAtElement(element);
        callbackPanel_delete.PerformCallback(key);
    }

    function OnAcceptDelete() {
        popup_delete.Hide();
    }
</script>
<asp:UpdatePanel ID="PopupDeletePanel" runat="server"  UpdateMode="Conditional">
    <ContentTemplate>
    <dx:ASPxPopupControl ID="popup_delete" ClientInstanceName="popup_delete" runat="server" AllowDragging="false" AllowResize="false" ShowCloseButton="false"
        PopupHorizontalAlign="OutsideRight" HeaderText="Удаление ВПО:">
        <ContentCollection>
           <dx:PopupControlContentControl ID="PopupControlContentControl3" runat="server">
                <dx:ASPxCallbackPanel ID="callbackPanel_delete" ClientInstanceName="callbackPanel_delete" runat="server"
                    Width="250px" Height="50px" OnCallback="CallbackPanelDeleteCallback" RenderMode="Table">
                    <PanelCollection>
                        <dx:PanelContent ID="PanelContent2" runat="server">              
                            <asp:Literal ID="deleteText" runat="server" Text=""></asp:Literal>
                            <dx:ASPxButton ID="btnDelete" runat="server" Text="удалить" 
                                AutoPostBack="False" OnClick="BtnDeleteClick">
                                <ClientSideEvents Click="OnAcceptDelete" />
                            </dx:ASPxButton>
                       </dx:PanelContent>
                    </PanelCollection>
                </dx:ASPxCallbackPanel>
            </dx:PopupControlContentControl>
        </ContentCollection>
    </dx:ASPxPopupControl>
    </ContentTemplate>
</asp:UpdatePanel>

       <div id='page_header'>
          Информация о ВПО
       </div>

       <table class='panel'>
			<tbody>
				<tr>
					<td class='panel-left'>
						<div class='panel-label'>ВПО:</div>
                           <asp:UpdatePanel ID="UpdatePanelMalwareInfo" runat="server"  UpdateMode="Conditional">
                             <ContentTemplate>
                               <div class='panel-text'>
                                   <dx:ASPxLabel ID="labelMalwareInfo" runat="server" Text="Обновление информации...">
                                   </dx:ASPxLabel>
                               </div>
                               <asp:Timer ID="UpdateInfo_timer" runat="server" Interval="1000"  ontick="UpdateInfoTimerTick">
                               </asp:Timer>
                             </ContentTemplate>
                               <Triggers>
                                 <asp:AsyncPostBackTrigger ControlID="UpdateInfo_timer" EventName="Tick" />
                               </Triggers>
                           </asp:UpdatePanel>
					</td>
				</tr>
                <tr>
                 <td class='panel-left'>
                   <br />
                 </td>
                </tr>
                <tr>
                  <td class='panel-left'>
                    <div class='panel-text'>
                        <dx:ASPxHyperLink ID="linkLoadNewMalware" runat="server" Text="Загрузить новое ВПО" NavigateUrl="~/Pages/Information/LoadMalware.aspx" Visible="false">
                        </dx:ASPxHyperLink>
                      </div>
                  </td>
                </tr>
			</tbody>
		</table>

        <div class="page_table">
             <asp:UpdatePanel ID="UpdatePanelMalware" runat="server"  UpdateMode="Conditional">
    <ContentTemplate>
        <dx:ASPxGridView ID="gridViewMalware" runat="server" 
            AutoGenerateColumns="False" EnableTheming="True" Theme="DevEx">
            <Columns>
                <dx:GridViewDataTextColumn Caption="Id" FieldName="Id" VisibleIndex="0" Visible=false>
                </dx:GridViewDataTextColumn>
                <dx:GridViewDataColumn Caption="Исполняемый файл" FieldName="Path" VisibleIndex="1">
                </dx:GridViewDataColumn>
                <dx:GridViewDataColumn Caption="Классификация" FieldName="Class" VisibleIndex="2">
                </dx:GridViewDataColumn>
                <dx:GridViewDataColumn Caption="Дополнительно" FieldName="Loaded" VisibleIndex="3">
                </dx:GridViewDataColumn>
                <dx:GridViewDataColumn  Caption="" Name="deleteColumn" VisibleIndex="4" Visible = "false">
                <DataItemTemplate>
                    <a href="javascript:;" onclick="OnDeleteClick(this, '<%# Container.KeyValue %>')">удалить</a>
                </DataItemTemplate>
            </dx:GridViewDataColumn>
            </Columns>
        </dx:ASPxGridView>
    </ContentTemplate>
    <Triggers>
         <asp:AsyncPostBackTrigger ControlID="gridViewMalware" EventName="DataBinding" />
    </Triggers>
</asp:UpdatePanel>
        </div>
</asp:Content>
